# Requisitos de Sistema para o novo Servidor de Produção do WPPConnector
# Sistema Operacional Recomendado: Ubuntu Server 22.04 LTS ou 24.04 LTS

# ==========================================
# COMANDOS DE INSTALAÇÃO (Execute com sudo)
# ==========================================

# 1. Atualizar a lista de pacotes do sistema
sudo apt update && sudo apt upgrade -y

# 2. Instalar utilitários básicos de rede e compilação
sudo apt install -y curl wget git build-essential ufw dirmngr apt-transport-https lsb-release ca-certificates

# 3. Instalar Node.js (Recomendamos a versão 20.x LTS)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs
# Verificar instalação: node -v && npm -v

# 4. Instalar PM2 para gerenciar os processos em segundo plano (Nohup aprimorado)
sudo npm install -g pm2
# Configurar o PM2 para iniciar junto com o servidor
pm2 startup

# 5. Instalar Banco de Dados PostgreSQL 15+
sudo apt install -y postgresql postgresql-contrib
sudo systemctl enable postgresql
sudo systemctl start postgresql

# 6. Instalar Redis Server (Cache e filas do WebSocket)
sudo apt install -y redis-server
sudo systemctl enable redis-server
sudo systemctl start redis-server

# 7. Instalar Nginx (Proxy Reverso para expor nas portas 80/443 e lidar com SSL)
sudo apt install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx

# 8. (Opcional) Instalar Certbot para SSL/HTTPS gratuito
sudo apt install -y certbot python3-certbot-nginx

# 9. Configurar Swap (MUITO IMPORTANTE se o servidor tiver 2GB ou 4GB de RAM)
# Cria um arquivo de paginação de 2GB para evitar travamentos durante o 'npm run build'
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
# Tornar o swap permanente:
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
